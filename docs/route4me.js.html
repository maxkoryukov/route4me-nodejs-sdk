<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>route4me.js - Documentation</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="Route4MeError.html">Route4MeError</a></li><li><a href="Route4MeApiError.html">Route4MeApiError</a></li><li><a href="Route4Me.html">Route4Me</a><ul class='members'><li data-type='member'><a href="Route4Me.html#Optimizations">Optimizations</a></li><li data-type='member'><a href="Route4Me.html#Vehicles">Vehicles</a></li><li data-type='member'><a href="Route4Me.html#.version">version</a></li></ul><ul class='methods'><li data-type='method'><a href="Route4Me.html#_validate">_validate</a></li><li data-type='method'><a href="Route4Me.html#_validateArgs">_validateArgs</a></li><li data-type='method'><a href="Route4Me.html#_makeRequest">_makeRequest</a></li></ul></li></ul><h3>Modules</h3><ul><li><a href="module-route4me-node.html">route4me-node</a><ul class='members'><li data-type='member'><a href="module-route4me-node.html#.Route4Me">Route4Me</a></li><li data-type='member'><a href="module-route4me-node.html#.Route4MeError">Route4MeError</a></li><li data-type='member'><a href="module-route4me-node.html#.Route4MeApiError">Route4MeApiError</a></li></ul></li></ul><h3>Namespaces</h3><ul><li><a href="Optimizations.html">Optimizations</a><ul class='methods'><li data-type='method'><a href="Optimizations.html#create">create</a></li><li data-type='method'><a href="Optimizations.html#get">get</a></li><li data-type='method'><a href="Optimizations.html#list">list</a></li><li data-type='method'><a href="Optimizations.html#remove">remove</a></li><li data-type='method'><a href="Optimizations.html#linkAddress">linkAddress</a></li><li data-type='method'><a href="Optimizations.html#unlinkAddress">unlinkAddress</a></li></ul></li><li><a href="Routes.html">Routes</a><ul class='methods'><li data-type='method'><a href="Routes.html#get">get</a></li><li data-type='method'><a href="Routes.html#list">list</a></li><li data-type='method'><a href="Routes.html#remove">remove</a></li></ul></li><li><a href="Vehicles.html">Vehicles</a><ul class='methods'><li data-type='method'><a href="Vehicles.html#list">list</a></li></ul></li></ul><h3>Tutorials</h3><ul><li><a href="tutorial-maintainer-guide.html">maintainer-guide</a></li></ul><h3>Interfaces</h3><ul><li><a href="ILogger.html">ILogger</a><ul class='methods'><li data-type='method'><a href="ILogger.html#debug">debug</a></li><li data-type='method'><a href="ILogger.html#info">info</a></li><li data-type='method'><a href="ILogger.html#warn">warn</a></li><li data-type='method'><a href="ILogger.html#error">error</a></li></ul></li></ul>
</nav>

<div id="main">
    
    <h1 class="page-title">route4me.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>"use strict"

const request  = require("superagent")
const debug    = require("debug")("route4me")
const _        = require("lodash")
const platform = require("platform")

const Optimizations   = require("./resources/optimizations")
const Vehicles        = require("./resources/vehicles")

const packageJson     = require("./../package.json")
const utils           = require("./utils")
const errors          = require("./errors")

/**
 * Route4Me main SDK class
 */
class Route4Me {
	/**
	 * Create new API client
	 * @param  {string}  apiKey API KEY
	 * @param  {object}  [options] Additional options for new instance
	 * @param  {string}  [options.baseUrl="https://route4me.com"] Base URL for sending requests
	 * @param  {ILogger} [options.logger]  Logger facility
	 * @param  {module:route4me-node~ValidationCallback} [options.validate=false]
	 * Validator for input and output parameters of the API methods. Set **falsey**
	 * value to skip autovalidation (in favor of manual check).
	 * @return {Route4Me}                  New API client
	 */
	constructor(apiKey, options) {
		const opt = {}
		_.defaults(opt, options, {
			"baseUrl": "https://route4me.com",
			"logger": utils.noopLogger,
			"validate": false,
		})

		// TODO: make a decision, whether this param could be configured
		opt.userAgent = `superagent/3.3.2 (${platform.name} ${platform.version}; Route4Me-${platform.name}/${Route4Me.version}) ${platform.description}`

		debug("init", opt)
		debug("version", Route4Me.version)

		if (!apiKey) {
			throw new errors.Route4MeError("'apiKey' is not set")
		}

		this._apiKey = apiKey
		this._baseUrl = opt.baseUrl
		this._userAgent = opt.userAgent

		this._logger = opt.logger
		/**
		 * Provides an validation interface of input-output parameters for
		 * certain internal classes.
		 *
		 * @since 0.1.4
		 * @internal
		 * @method
		 * @type {module:route4me-node~ValidationCallback}
		 */
		this._validate = typeof opt.validate === "function" ? opt.validate : _.noop

		/**
		 * Used for validation of input arguments
		 *
		 * @since 0.1.7
		 * @internal
		 * @method
		 * @type {module:route4me-node~ValidationCallback}
		 */
		this._validateArgs = this._validate

		/**
		 * **Optimizations** related API calls
		 * @type {Optimizations}
		 */
		this.Optimizations = new Optimizations(this)
		/**
		 * **Vehicles** related API calls
		 * @type {Vehicles}
		 */
		this.Vehicles = new Vehicles(this)

		this._logger.debug({ msg: "initialized" })
	}

	/**
	 * Version of this API client
	 *
	 * @since 0.1.3
	 *
	 * @return {string} Version
	 * @static
	 * @readonly
	 */
	static get version() {
		return packageJson.version
	}

	/**
	 * Wrapper around {@link external:superagent} with all options applied.
	 *
	 * @internal
	 *
	 * @param {object} options              Request options
	 * @param {string} options.method       HTTP method
	 * @param {string} options.path         Server path
	 * @param {object} [options.qs]         Query string
	 * @param {object} [options.body]       Body
	 * @param {null|string} [options.schemaName=null] The name of JSON Schema which should be used for
	 * validation of the response
	 *
	 * @param {module:route4me-node~RequestCallback}    [callback]
	 */
	_makeRequest(options, callback) {
		const apiUrl = `${this._baseUrl}${options.path}`
		const qs = options.qs ||  {} /* query string */
		const body = options.body || null // {} /* body */
		const schemaName = options.schemaName
		const timeouts = {
			response: 5000,  // Wait 5 seconds for the server to start sending,
			deadline: 10000, // but allow 10 seconds to finish loading.
		}
		let method = options.method.toLowerCase()
		if (method === "delete") {
			method = "del"
		}

		qs["api_key"] = this._apiKey

		const resHandler = new utils.ResponseHandler(this._logger, this._validate, schemaName, callback)

		debug("sending request", apiUrl, qs)
		this._logger.info({ msg: "sending request", "url": apiUrl, "queryString": qs })
		request[method](apiUrl)
			.set("User-Agent", this._userAgent)
			.query(qs)
			.timeout(timeouts)
			.send(body)
			.type("application/json")
			.accept("application/json")
			.redirects(1000)	// unlimited number of redirects
			.end((err, res) => resHandler.callback(err, res))
	}
}

module.exports = Route4Me
</code></pre>
        </article>
    </section>




</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.3</a> on Sun Jan 29 2017 00:34:02 GMT+0500 (+05) using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>
